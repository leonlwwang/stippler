(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();const W=(r,i,s,c)=>{const e={x:r,y:i},o={x:s,y:c};return{x:t=>Math.pow(1-t,3)*0+3*Math.pow(1-t,2)*t*e.x+3*(1-t)*Math.pow(t,2)*o.x+Math.pow(t,3)*1,y:t=>Math.pow(1-t,3)*0+3*Math.pow(1-t,2)*t*e.y+3*(1-t)*Math.pow(t,2)*o.y+Math.pow(t,3)*1}};let b=!1;const R=document.getElementById("file-btn"),q=document.getElementById("image-form");R.onchange=()=>{q.remove();const r=new Image,i=R.files[0],s=new FileReader;s.readAsDataURL(i),s.onload=()=>{r.src=s.result};const c=document.getElementById("handle"),e=document.createElement("div");e.className="loader";const o=document.createElement("div");o.className="wrapper",o.appendChild(e),document.body.insertBefore(o,c);const d=document.createElement("canvas");d.id="stippler",d.style.display="none",document.body.insertBefore(d,c);const t=document.getElementById("stippler").getContext("2d",{willReadFrequently:!0});r.onload=()=>{const{width:g,height:h}=U(t,r,500),F=t.getImageData(0,0,g,h);t.drawImage(r,0,0,r.width,r.height,0,0,g,h);const O=t.getImageData(0,0,g,h),v=new Worker(new URL("/stippler/assets/worker-9dff5553.js",self.location),{type:"module"}),I=new Worker(new URL("/stippler/assets/worker-9dff5553.js",self.location),{type:"module"});let l=null,m=null,M=null;const N=new Date;v.postMessage({imageData:F,density:10,sharpness:100}),I.postMessage({imageData:O,density:10,sharpness:100}),v.onmessage=n=>{l=n.data,M=l.slice(),B()},I.onmessage=n=>{m=n.data,B()};const B=()=>{if(l&&m){for(let a=0,f=m.length;a<f;a+=2)m[a]=m[a]-l[a],m[a+1]=m[a+1]-l[a+1];const n=new Date;o.remove();const u=document.createElement("p");u.textContent=m.length+l.length+" points generated in "+(n-N)/1e3+" sec",document.body.insertBefore(u,c),d.style.display="block",console.log("animating..."),y(l),w(l,performance.now(),0)}},{y:P}=W(1,0,0,1),E=n=>P(n),y=n=>{t.clearRect(0,0,g,h),t.fillStyle="black";for(let u=0,a=n.length;u<a;u+=2){const f=n[u],L=n[u+1];t.fillRect(f,L,1.1,1.1)}},A=1250,w=(n,u,a)=>{const f=performance.now(),x=(f-u)/A;a+=x;const D=E(a)-E(a-x);for(let p=0,S=n.length;p<S;p+=2)n[p]=n[p]+m[p]*D,n[p+1]=n[p+1]+m[p+1]*D;y(n),a<1?requestAnimationFrame(()=>w(n,f,a)):(console.log("animation completed"),b=!0)},C=n=>{n.target.id==="stippler"&&b&&(b=!1,console.log("replaying..."),l=M.slice(),y(l),w(l,performance.now(),0))};d.addEventListener("click",C)}};const U=(r,i,s)=>{const c=Math.round(s*i.height/i.width);return r.canvas.width=s,r.canvas.height=c,{width:s,height:c}};
